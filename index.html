<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🎵 Sync Music</title>
  <meta name="description" content="A synchronized music listening app demo with mock real-time sync and a visual player (no YouTube iframes)." />
  <style>
    :root{
      --purple-1:#667eea; /* primary */
      --purple-2:#764ba2; /* primary */
      --accent-1:#ff6b6b; /* coral */
      --accent-2:#ffd54f; /* amber */
      --glass-bg:rgba(255,255,255,.12);
      --glass-border:rgba(255,255,255,.30);
      --text:#ffffff;
      --muted:#e9e9f6;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; overflow-x:hidden; color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background:#1a1130;
    }

    /* Background image + gradient overlay */
    .bg{
      position:fixed; inset:0; z-index:-2;
      background:url('https://images.unsplash.com/photo-1511379938547-c1f69419868d?q=80&w=2400&auto=format&fit=crop') center/cover no-repeat fixed;
      filter: blur(3px) brightness(0.4);
      transform:scale(1.05);
    }
    .gradient{
      position:fixed; inset:0; z-index:-1;
      background:linear-gradient(135deg, rgba(102,126,234,0.70) 0%, rgba(118,75,162,0.70) 100%);
    }

    /* Global layout */
    header{
      width:100%; padding:24px 20px 8px; text-align:center;
      text-shadow:0 6px 22px rgba(0,0,0,.45), 0 0 2px rgba(0,0,0,.6);
    }
    .title{font-size:clamp(28px,3vw,42px); margin:0 0 6px; letter-spacing:.4px}
    .tagline{opacity:.9; margin:0; font-weight:500}

    .container{
      max-width:1100px; margin:18px auto 64px; padding:0 16px; display:grid; gap:18px;
      grid-template-columns: 1.1fr .9fr;
    }
    @media (max-width: 940px){ .container{grid-template-columns:1fr} }

    /* Glass cards */
    .card{
      background:var(--glass-bg);
      border:1px solid var(--glass-border);
      border-radius:22px; padding:18px 18px;
      box-shadow: 0 10px 40px rgba(0,0,0,.25), inset 0 0 40px rgba(255,255,255,.03);
      backdrop-filter: blur(15px) saturate(130%);
    }

    /* Setup screen */
    .setup{display:grid; gap:14px}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .input{
      flex:1 1 300px; padding:14px 14px; border-radius:14px; border:1px solid rgba(255,255,255,.25);
      background:rgba(255,255,255,.08); color:var(--text); outline:none;
      box-shadow: inset 0 2px 6px rgba(0,0,0,.2);
    }
    .btn{
      appearance:none; border:1px solid rgba(255,255,255,.3); color:white;
      background:linear-gradient(145deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:700;
      transition: transform .15s ease, box-shadow .2s ease, background .2s ease;
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
    }
    .btn:hover{ transform:translateY(-2px) scale(1.02); box-shadow:0 14px 36px rgba(0,0,0,.35)}
    .btn:active{ transform:translateY(0) scale(.98)}
    .btn.primary{ background:linear-gradient(135deg, var(--purple-1), var(--purple-2)); border-color:rgba(255,255,255,.45)}
    .btn.alt{ background:linear-gradient(135deg, var(--accent-1), var(--accent-2)); color:#2b2633 }

    .hint{opacity:.9; font-size:.95rem}

    /* Room screen layout */
    .room.hidden, .setup.hidden{ display:none }

    .statusBar{
      display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-bottom:10px
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px;
      border:1px solid rgba(255,255,255,.32); background:rgba(255,255,255,.10);
      font-weight:600; box-shadow: inset 0 0 20px rgba(255,255,255,.06)
    }
    .dot{width:10px; height:10px; border-radius:50%; background:#c0c0c0; box-shadow:0 0 10px currentColor}
    .dot.wait{ background:#ffd54f }
    .dot.ok{ background:#3de57a }
    .dot.err{ background:#ff6b6b }

    .roomGrid{ display:grid; gap:18px; grid-template-columns: 1.2fr .8fr }
    @media (max-width: 940px){ .roomGrid{ grid-template-columns:1fr } }

    /* Player card */
    .player{
      display:grid; grid-template-columns: 140px 1fr; gap:16px; align-items:center;
    }
    @media (max-width:560px){ .player{grid-template-columns: 110px 1fr} }

    .discWrap{ position:relative; width:140px; height:140px; }
    .disc{ position:absolute; inset:0; border-radius:50%;
      background:
        radial-gradient(circle at 50% 50%, #111 0 12%, #222 13% 32%, #111 33% 100%),
        radial-gradient(circle at 50% 50%, #333 0 50%, #111 51% 100%);
      box-shadow: inset 0 0 30px rgba(0,0,0,.7), 0 12px 40px rgba(0,0,0,.45);
      animation: spin 6s linear infinite; animation-play-state: paused;
    }
    .disc::after{content:""; position:absolute; inset:45% 45%; border-radius:50%; background:var(--accent-2); box-shadow:0 0 12px rgba(0,0,0,.6) inset}
    .disc.playing{ animation-play-state: running }

    @keyframes spin{ to{ transform: rotate(360deg)} }

    .meta b{ display:block; font-size:1.05rem; letter-spacing:.2px }
    .meta small{ opacity:.9 }

    .waves{ display:flex; align-items:flex-end; gap:6px; height:42px; margin-top:8px }
    .bar{ width:8px; border-radius:6px; background:linear-gradient(180deg, var(--accent-2), var(--accent-1));
      height:8px; opacity:.55; animation: bounce 1.2s ease-in-out infinite; animation-play-state: paused;
      box-shadow:0 6px 18px rgba(0,0,0,.35)
    }
    .bar:nth-child(1){ animation-delay:0s }
    .bar:nth-child(2){ animation-delay:.1s }
    .bar:nth-child(3){ animation-delay:.2s }
    .bar:nth-child(4){ animation-delay:.3s }
    .bar:nth-child(5){ animation-delay:.4s }
    @keyframes bounce{ 0%,100%{ height:8px } 50%{ height:42px } }
    .playing + .meta + .waves .bar, .waves.playing .bar{ animation-play-state: running; opacity:1 }

    /* Controls */
    .controls{ display:flex; gap:14px; align-items:center; margin-top:12px; flex-wrap:wrap }
    .cbtn{
      width:54px; height:54px; border-radius:999px; display:grid; place-items:center; border:1px solid rgba(255,255,255,.35);
      background: linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.07));
      box-shadow: 0 10px 24px rgba(0,0,0,.35), inset 0 -6px 10px rgba(0,0,0,.35), inset 0 8px 10px rgba(255,255,255,.05);
      cursor:pointer; font-size:20px; transition:transform .12s ease, box-shadow .2s ease, filter .2s ease
    }
    .cbtn:hover{ transform: translateY(-2px) scale(1.04); box-shadow:0 14px 36px rgba(0,0,0,.45); filter: drop-shadow(0 0 8px rgba(255,255,255,.3)) }
    .cbtn:active{ transform:translateY(0) scale(.98) }
    .cbtn.primary{ border-color:rgba(255,255,255,.6) }

    .openYT{ margin-left:auto }
    .openYT .btn{ padding:10px 14px }

    /* Playlist */
    .playlist{ max-height:360px; overflow:auto; padding-right:6px }
    .playlist::-webkit-scrollbar{ width:8px }
    .playlist::-webkit-scrollbar-thumb{ background:rgba(255,255,255,.25); border-radius:12px }
    .track{ display:flex; gap:10px; padding:10px 12px; border-radius:12px; align-items:center; cursor:pointer;
      border:1px solid transparent; transition: background .2s ease, border-color .2s ease, transform .1s ease
    }
    .track:hover{ background:rgba(255,255,255,.08); transform:translateY(-1px) }
    .track.active{ background:rgba(255,255,255,.14); border-color:rgba(255,255,255,.35) }
    .track .idx{ width:28px; height:28px; border-radius:8px; display:grid; place-items:center; font-weight:700;
      background:linear-gradient(135deg, var(--purple-1), var(--purple-2)) }
    .track .title{ font-weight:700 }
    .track .artist{ opacity:.85 }

    /* Footer */
    footer{ text-align:center; opacity:.9; padding:14px; font-size:.95rem }

    /* Mobile tweaks */
    @media (max-width:540px){
      .controls{ flex-direction:column; align-items:stretch }
      .openYT{ width:100%; margin-left:0 }
      .cbtn{ width:58px; height:58px }
      .discWrap{ width:110px; height:110px }
    }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>
  <div class="gradient" aria-hidden="true"></div>

  <header>
    <h1 class="title">🎵 Sync Music</h1>
    <p class="tagline">Listen together in real-time — room codes, mock sync, and a slick visual player. No iframes needed.</p>
  </header>

  <!-- SETUP SCREEN -->
  <main class="container">
    <section id="setupCard" class="card setup" aria-label="Setup">
      <h2 style="margin:2px 0 6px">Start a session</h2>
      <div class="row">
        <input id="playlistInput" type="url" class="input" placeholder="Paste YouTube playlist URL (optional)" />
        <button class="btn primary" onclick="createRoom()">Create Room</button>
        <button class="btn alt" onclick="joinFlow()">Join Room</button>
      </div>
      <p class="hint">We use a <b>mock real‑time socket</b> to simulate syncing. Visual player only; click <em>Open in YouTube</em> for the actual videos.</p>
      <div id="joinRow" class="row" style="display:none">
        <input id="joinCode" class="input" placeholder="Enter 6‑digit room code" inputmode="numeric" maxlength="6" />
        <button class="btn" onclick="joinRoom()">Join</button>
      </div>
    </section>

    <!-- ROOM SCREEN (initially hidden) -->
    <section id="roomCard" class="card room hidden" aria-label="Room">
      <div class="statusBar">
        <div class="pill"><span id="statusDot" class="dot wait"></span><span id="statusText">Waiting for partner…</span></div>
        <div class="pill">Room <b id="roomCode">— — — — — —</b></div>
        <div class="pill">Latency <b id="latency">—</b> ms</div>
      </div>

      <div class="roomGrid">
        <!-- Player left -->
        <div class="playerWrap">
          <div class="player">
            <div class="discWrap">
              <div id="disc" class="disc" aria-hidden="true"></div>
            </div>
            <div>
              <div class="meta">
                <b id="songTitle">—</b>
                <small id="songArtist">—</small>
              </div>
              <div id="waves" class="waves" aria-hidden="true">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
              </div>

              <div class="controls">
                <button class="cbtn" title="Previous" onclick="previousSong()">⏮</button>
                <button id="playBtn" class="cbtn primary" title="Play/Pause" onclick="togglePlayPause()">▶</button>
                <button class="cbtn" title="Next" onclick="nextSong()">⏭</button>

                <div class="openYT">
                  <button class="btn" onclick="openInYouTube()">Open in YouTube ↗</button>
                </div>
              </div>
            </div>
          </div>

          <div style="margin-top:10px; opacity:.9">
            <small id="nowText">Ready.</small>
          </div>
        </div>

        <!-- Playlist right -->
        <div>
          <h3 style="margin:0 0 10px">Playlist</h3>
          <div id="playlist" class="playlist"></div>
        </div>
      </div>
    </section>
  </main>

  <footer>Built for portfolios and demos • Glassmorphism • Mock WebSocket sync • © 2025</footer>

<script>
// -------------------------------
// Utilities
// -------------------------------
const $ = (q)=>document.querySelector(q);
const $$ = (q)=>Array.from(document.querySelectorAll(q));
function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }
function clamp(n,min,max){ return Math.min(max,Math.max(min,n)); }

// -------------------------------
// Mock Socket (roomed, 2 peers max)
// -------------------------------
const mockSocket = (()=>{
  const rooms = new Map(); // code -> { peers:Set(fn), lastLatency:number }
  let myHandlers = {};
  let myRoom = null;
  let myId = Math.random().toString(36).slice(2,9);

  function on(event, handler){ (myHandlers[event] ||= []).push(handler); }
  function off(event, handler){ myHandlers[event] = (myHandlers[event]||[]).filter(h=>h!==handler); }
  function _emitLocal(event, payload){ (myHandlers[event]||[]).forEach(h=>h(payload)); }

  function join(code){
    if(!rooms.has(code)) rooms.set(code, { peers:new Set(), lastLatency:0 });
    myRoom = code; rooms.get(code).peers.add(_emitLocal);
    // Simulate partner connect
    setTimeout(()=>broadcast('peer:joined', { id: myId }), 60);
    return true;
  }
  function leave(){ if(myRoom && rooms.has(myRoom)){ rooms.get(myRoom).peers.delete(_emitLocal); } myRoom=null; }

  function networkLatency(){ // 40-180ms
    return Math.floor(40 + Math.random()*140);
  }

  function broadcast(event, payload){
    if(!myRoom) return;
    const room = rooms.get(myRoom); if(!room) return;
    const lag = networkLatency(); room.lastLatency = lag;
    setTimeout(()=>{
      room.peers.forEach(emit=>{ if(emit!==_emitLocal) emit({ event, payload, from: myId, ts: Date.now() }); });
      // loopback for latency readback if needed
    }, lag);
    // locally notify as well for optimistic UI
    _emitLocal({ event, payload, from: myId, ts: Date.now(), local:true });
    // update latency pill
    const latEl = document.getElementById('latency'); if(latEl) latEl.textContent = lag;
  }

  return { on, off, join, leave, broadcast };
})();

// -------------------------------
// App State
// -------------------------------
const App = {
  role: 'host', // 'host' | 'guest'
  roomCode: null,
  connected: false,
  isPlaying: false,
  songIndex: 0,
  currentTime: 0, // seconds (simulated)
  playlistId: null,
  tracks: [],
  ticker: null,
  syncTimer: null,
};

// Demo tracks generator from playlist URL (no API calls)
function tracksFromPlaylist(url){
  const listIdMatch = /[?&]list=([a-zA-Z0-9_-]+)/.exec(url||'');
  const listId = listIdMatch ? listIdMatch[1] : 'DEMO_LIST';
  const base = [
    { id: 'dQw4w9WgXcQ', title: 'Never Gonna Give You Up', artist: 'Rick Astley', duration: 213 },
    { id: 'fJ9rUzIMcZQ', title: 'Bohemian Rhapsody', artist: 'Queen', duration: 354 },
    { id: '3JZ_D3ELwOQ', title: 'See You Again', artist: 'Wiz Khalifa ft. Charlie Puth', duration: 230 },
    { id: 'kJQP7kiw5Fk', title: 'Despacito', artist: 'Luis Fonsi ft. Daddy Yankee', duration: 281 },
    { id: 'CevxZvSJLk8', title: 'Roar', artist: 'Katy Perry', duration: 221 },
  ];
  // Map into playlist-flavored links
  return base.map((t,i)=>({
    ...t,
    url: `https://www.youtube.com/watch?v=${t.id}&list=${listId}&index=${i+1}`,
  }));
}

// -------------------------------
// UI Rendering
// -------------------------------
function setStatus(text, type='wait'){
  document.getElementById('statusText').textContent = text;
  const dot = document.getElementById('statusDot');
  dot.classList.remove('wait','ok','err'); dot.classList.add(type);
}

function renderPlaylist(){
  const wrap = document.getElementById('playlist'); wrap.innerHTML='';
  App.tracks.forEach((t, i)=>{
    const el = document.createElement('div'); el.className = 'track' + (i===App.songIndex?' active':'');
    el.innerHTML = `
      <div class="idx">${String(i+1).padStart(2,'0')}</div>
      <div style="flex:1">
        <div class="title">${t.title}</div>
        <div class="artist">${t.artist}</div>
      </div>
      <div style="opacity:.8">${fmtTime(t.duration)}</div>`;
    el.onclick = ()=>selectSong(i, true);
    wrap.appendChild(el);
  });
}

function highlightActive(){
  $$('#playlist .track').forEach((el, i)=>{
    if(i===App.songIndex) el.classList.add('active'); else el.classList.remove('active');
  });
}

function fmtTime(sec){ const m = Math.floor(sec/60), s = String(Math.floor(sec%60)).padStart(2,'0'); return `${m}:${s}`; }

function loadCurrentVideo(emitSync=false){
  const t = App.tracks[App.songIndex];
  document.getElementById('songTitle').textContent = t.title;
  document.getElementById('songArtist').textContent = t.artist;
  document.getElementById('nowText').textContent = `Track ${App.songIndex+1} • ${fmtTime(App.currentTime)} / ${fmtTime(t.duration)}`;
  highlightActive();
  if(emitSync){ mockSocket.broadcast('song:change', { index: App.songIndex, time:0 }); }
}

function openInYouTube(){ const t = App.tracks[App.songIndex]; window.open(t.url, '_blank'); }

// -------------------------------
// Controls
// -------------------------------
function togglePlayPause(emitSync=true){
  App.isPlaying = !App.isPlaying;
  document.getElementById('playBtn').textContent = App.isPlaying ? '⏸' : '▶';
  const disc = document.getElementById('disc');
  const waves = document.getElementById('waves');
  if(App.isPlaying){ disc.classList.add('playing'); waves.classList.add('playing'); setStatus('Connected • Playing', 'ok'); }
  else { disc.classList.remove('playing'); waves.classList.remove('playing'); setStatus('Connected • Paused', 'ok'); }
  if(emitSync) mockSocket.broadcast('transport:toggle', { isPlaying: App.isPlaying, time: App.currentTime, index: App.songIndex });
}

function nextSong(emitSync=true){
  App.songIndex = (App.songIndex + 1) % App.tracks.length; App.currentTime = 0; loadCurrentVideo(false);
  if(emitSync) mockSocket.broadcast('song:change', { index: App.songIndex, time: 0 });
}
function previousSong(emitSync=true){
  App.songIndex = (App.songIndex - 1 + App.tracks.length) % App.tracks.length; App.currentTime = 0; loadCurrentVideo(false);
  if(emitSync) mockSocket.broadcast('song:change', { index: App.songIndex, time: 0 });
}
function selectSong(i, emitSync=true){ App.songIndex = i; App.currentTime=0; loadCurrentVideo(false); if(emitSync) mockSocket.broadcast('song:change', { index: i, time:0 }); }

// Simulated clock ticking while playing
function startTicker(){
  stopTicker();
  App.ticker = setInterval(()=>{
    if(!App.isPlaying) return;
    const t = App.tracks[App.songIndex];
    App.currentTime += 1; if(App.currentTime >= t.duration){ nextSong(true); return; }
    document.getElementById('nowText').textContent = `Track ${App.songIndex+1} • ${fmtTime(App.currentTime)} / ${fmtTime(t.duration)}`;
  }, 1000);
}
function stopTicker(){ if(App.ticker) clearInterval(App.ticker); }

// -------------------------------
// Time Sync (every 5s)
// -------------------------------
function startSyncLoop(){
  stopSyncLoop();
  App.syncTimer = setInterval(()=>{
    // Host drives periodic sync; guest mirrors
    if(App.role === 'host'){
      mockSocket.broadcast('sync:time', { index: App.songIndex, time: App.currentTime, isPlaying: App.isPlaying });
    }
  }, 5000);
}
function stopSyncLoop(){ if(App.syncTimer) clearInterval(App.syncTimer); }

// -------------------------------
// Room Flow
// -------------------------------
function createRoom(){
  App.role = 'host';
  const code = String(Math.floor(100000 + Math.random()*900000));
  App.roomCode = code; document.getElementById('roomCode').textContent = code;
  document.getElementById('setupCard').classList.add('hidden');
  document.getElementById('roomCard').classList.remove('hidden');
  setStatus('Waiting for partner…','wait');

  const url = document.getElementById('playlistInput').value.trim();
  App.tracks = tracksFromPlaylist(url);
  renderPlaylist();
  loadCurrentVideo();
  mockSocket.join(code);
  startTicker(); startSyncLoop();
}

function joinFlow(){ document.getElementById('joinRow').style.display = 'flex'; document.getElementById('joinCode').focus(); }

function joinRoom(){
  const code = document.getElementById('joinCode').value.replace(/\D/g,'').slice(0,6);
  if(code.length!==6){ alert('Enter a 6-digit room code'); return; }
  App.role = 'guest';
  App.roomCode = code; document.getElementById('roomCode').textContent = code;
  document.getElementById('setupCard').classList.add('hidden');
  document.getElementById('roomCard').classList.remove('hidden');

  // For guest, build demo tracks too (they will be overwritten by sync events from host);
  const url = document.getElementById('playlistInput').value.trim();
  App.tracks = tracksFromPlaylist(url);
  renderPlaylist();
  loadCurrentVideo();

  mockSocket.join(code);
  startTicker(); startSyncLoop();
}

// -------------------------------
// Socket Event Handlers (mirror partner actions instantly)
// -------------------------------
mockSocket.on('any', (msg)=>{}); // placeholder
mockSocket.on('event', (msg)=>{});

mockSocket.on('peer:joined', ({})=>{
  if(App.role==='host'){
    setStatus('Partner connected','ok'); App.connected = true;
    // Share current state immediately
    mockSocket.broadcast('state:init', { tracks: App.tracks, index: App.songIndex, time: App.currentTime, isPlaying: App.isPlaying });
  } else {
    setStatus('Connected','ok'); App.connected = true;
  }
});

mockSocket.on('state:init', ({ payload })=>{
  if(App.role==='guest'){
    App.tracks = payload.tracks; renderPlaylist();
    App.songIndex = payload.index; App.currentTime = payload.time; App.isPlaying = payload.isPlaying;
    loadCurrentVideo(false);
    // apply play/pause visuals
    const isPlaying = App.isPlaying; App.isPlaying=false; togglePlayPause(false); if(!isPlaying) togglePlayPause(false);
  }
});

mockSocket.on('transport:toggle', ({ payload })=>{
  if(payload.index!==undefined) App.songIndex = payload.index;
  App.currentTime = payload.time; const was = App.isPlaying; App.isPlaying = payload.isPlaying;
  if(App.isPlaying !== was){ togglePlayPause(false); }
  loadCurrentVideo(false);
});

mockSocket.on('song:change', ({ payload })=>{
  App.songIndex = payload.index; App.currentTime = payload.time || 0; loadCurrentVideo(false);
});

mockSocket.on('sync:time', ({ payload })=>{
  if(App.role === 'guest'){
    if(payload.index !== App.songIndex){ App.songIndex = payload.index; App.currentTime = payload.time; loadCurrentVideo(false); }
    // nudge local time toward host within tolerance
    const drift = payload.time - App.currentTime;
    if(Math.abs(drift) > 1){ App.currentTime = payload.time; }
    if(App.isPlaying !== payload.isPlaying){ App.isPlaying = payload.isPlaying; togglePlayPause(false); }
  }
});

// -------------------------------
// Startup
// -------------------------------
window.addEventListener('load', ()=>{
  // keyboard: space = play/pause
  window.addEventListener('keydown', (e)=>{
    if(e.code==='Space' && !e.repeat){ e.preventDefault(); togglePlayPause(true); }
  });
});
</script>
</body>
</html>
